<!doctype html><html class=no-js lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://www.instancio.org/articles/creating-object-templates-using-models/ rel=canonical><link href=../../assets/favicon.ico rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.5.47" name=generator><title>Creating object templates using Models - Instancio</title><link href=../../assets/stylesheets/main.6f8fc17f.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><script src="https://www.googletagmanager.com/gtag/js?id=G-MYZQVSS3LL" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[];gtag(`js`,new Date());gtag(`config`,`G-MYZQVSS3LL`)</script><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta content="Instancio is a test data generation library for Java. Its goals are to automate data setup, make tests more concise, and reduce test maintenance effort." name=description><body data-md-color-accent=deep-orange data-md-color-primary=green data-md-color-scheme=default dir=ltr><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay for=__drawer></label><div data-md-component=skip><a class=md-skip href=#creating-object-templates-using-models> Skip to content </a></div><div data-md-component=announce></div><header class="md-header md-header--shadow md-header--lifted" data-md-component=header><nav class="md-header__inner md-grid" aria-label=Header><a class="md-header__button md-logo" aria-label=Instancio data-md-component=logo href=../.. title=Instancio> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a><label class="md-header__button md-icon" for=__drawer><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></label><div class=md-header__title data-md-component=header-title><div class=md-header__ellipsis><div class=md-header__topic><span class=md-ellipsis> Instancio </span></div><div class=md-header__topic data-md-component=header-topic><span class=md-ellipsis> Creating object templates using Models </span></div></div></div><form class=md-header__option data-md-component=palette><input aria-label="Switch to dark mode" class=md-option data-md-color-accent=deep-orange data-md-color-media data-md-color-primary=green data-md-color-scheme=default id=__palette_0 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label><input aria-label="Switch to light mode" class=md-option data-md-color-accent=deep-orange data-md-color-media data-md-color-primary=green data-md-color-scheme=slate id=__palette_1 name=__palette type=radio><label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg></label></form><script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script><label class="md-header__button md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text><label class="md-search__icon md-icon" for=__search><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg></label><nav aria-label=Search class=md-search__options><button class="md-search__icon md-icon" aria-label=Clear tabindex=-1 title=Clear type=reset><svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></nav></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix tabindex=0><div class=md-search-result data-md-component=search-result><div class=md-search-result__meta>Initializing search</div><ol class=md-search-result__list role=presentation></ol></div></div></div></div></div><div class=md-header__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/instancio/instancio> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>instancio</div> </a></div></nav><nav aria-label=Tabs class=md-tabs data-md-component=tabs><div class=md-grid><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../..> Home </a><li class=md-tabs__item><a class=md-tabs__link href=../../getting-started/> Getting Started </a><li class=md-tabs__item><a class=md-tabs__link href=../../user-guide/> User Guide </a><li class=md-tabs__item><a class=md-tabs__link href=../../building/> Building </a><li class=md-tabs__item><a class=md-tabs__link href=../> Articles </a></ul></div></nav></header><div class=md-container data-md-component=container><main class=md-main data-md-component=main><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0><label class=md-nav__title for=__drawer><a class="md-nav__button md-logo" aria-label=Instancio data-md-component=logo href=../.. title=Instancio> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Instancio</label><div class=md-nav__source><a title="Go to repository" class=md-source data-md-component=source href=https://github.com/instancio/instancio> <div class="md-source__icon md-icon"><svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg></div> <div class=md-source__repository>instancio</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../..> <span class=md-ellipsis> Home </span> </a><li class=md-nav__item><a class=md-nav__link href=../../getting-started/> <span class=md-ellipsis> Getting Started </span> </a><li class=md-nav__item><a class=md-nav__link href=../../user-guide/> <span class=md-ellipsis> User Guide </span> </a><li class=md-nav__item><a class=md-nav__link href=../../building/> <span class=md-ellipsis> Building </span> </a><li class=md-nav__item><a class=md-nav__link href=../> <span class=md-ellipsis> Articles </span> </a></ul></nav></div></div></div><div class=md-content data-md-component=content><article class="md-content__inner md-typeset"><h1 id=creating-object-templates-using-models>Creating object templates using Models<a title="Permanent link" class=headerlink href=#creating-object-templates-using-models>¶</a></h1><h2 id=introduction>Introduction<a title="Permanent link" class=headerlink href=#introduction>¶</a></h2><p>One of the challenges of setting up data for different test cases is creating objects in different states. Test classes will often have helper methods with arguments for creating objects. Even worse, common setup code will sometimes be duplicated across test methods. Manual data setup can get quite complicated as classes get bigger and more complex. This is especially true for classes with many relationships. In this article, we will show how Models can be used to solve these challenges.<div class="admonition note"><p class=admonition-title>GitHub link to the sample project is provided at the end of the article.</div><h2 id=testing-background>Testing background<a title="Permanent link" class=headerlink href=#testing-background>¶</a></h2><p>We will be testing a service that converts a college <code>Applicant</code> to an Avro class <code>ApplicantAvro</code>. The <code>Applicant</code> class is provided below. The <code>ApplicantAvro</code> class is auto-generated using an Avro schema, but essentially it has the same structure.<div class=highlight><pre><span></span><code><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=kd>class</span> <span class=nc>Applicant</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>    </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span>
<a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>firstName</span><span class=p>;</span>
<a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>middleName</span><span class=p>;</span>
<a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>lastName</span><span class=p>;</span>
<a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>    </span><span class=n>Integer</span><span class=w> </span><span class=n>age</span><span class=p>;</span>
<a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>    </span><span class=n>Grade</span><span class=w> </span><span class=n>grade</span><span class=p>;</span>
<a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>    </span><span class=n>Address</span><span class=w> </span><span class=n>address</span><span class=p>;</span>
<a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=p>}</span>
<a href=#__codelineno-0-10 id=__codelineno-0-10 name=__codelineno-0-10></a>
<a href=#__codelineno-0-11 id=__codelineno-0-11 name=__codelineno-0-11></a><span class=kd>enum</span><span class=w> </span><span class=n>Grade</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=n>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=p>,</span><span class=w> </span><span class=n>F</span><span class=w> </span><span class=p>}</span>
<a href=#__codelineno-0-12 id=__codelineno-0-12 name=__codelineno-0-12></a>
<a href=#__codelineno-0-13 id=__codelineno-0-13 name=__codelineno-0-13></a><span class=kd>class</span> <span class=nc>Address</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-0-14 id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>street</span><span class=p>;</span>
<a href=#__codelineno-0-15 id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>city</span><span class=p>;</span>
<a href=#__codelineno-0-16 id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>country</span><span class=p>;</span>
<a href=#__codelineno-0-17 id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>postalCode</span><span class=p>;</span>
<a href=#__codelineno-0-18 id=__codelineno-0-18 name=__codelineno-0-18></a><span class=p>}</span>
</code></pre></div><p>Our conversion service <code>ApplicantToAvroMapper</code> requires that an applicant is 18-25 years old and has achieved grade A or B. If those conditions are met, it constructs an Avro object and returns it as the result.<div class=highlight><pre><span></span><code><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ApplicantToAvroMapper</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>
<a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=nf>toAvro</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>        </span><span class=n>Validate</span><span class=p>.</span><span class=na>isTrue</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getAge</span><span class=p>()</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=mi>18</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>applicant</span><span class=p>.</span><span class=na>getAge</span><span class=p>()</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=mi>25</span><span class=p>,</span>
<a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>                </span><span class=s>"Applicant must be between 18 and 25 years of age"</span><span class=p>);</span>
<a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a>
<a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>        </span><span class=n>Validate</span><span class=p>.</span><span class=na>isTrue</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getGrade</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>applicant</span><span class=p>.</span><span class=na>getGrade</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>,</span>
<a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>                </span><span class=s>"Applicant's grade must be either A or B"</span><span class=p>);</span>
<a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a>
<a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ApplicantAvro</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span>
<a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=w>                </span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getFirstName</span><span class=p>())</span>
<a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>                </span><span class=p>.</span><span class=na>setMiddleName</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>())</span>
<a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=w>                </span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getLastName</span><span class=p>())</span>
<a href=#__codelineno-1-14 id=__codelineno-1-14 name=__codelineno-1-14></a><span class=w>                </span><span class=p>.</span><span class=na>setAge</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getAge</span><span class=p>())</span>
<a href=#__codelineno-1-15 id=__codelineno-1-15 name=__codelineno-1-15></a><span class=w>                </span><span class=p>.</span><span class=na>setGrade</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getGrade</span><span class=p>().</span><span class=na>toString</span><span class=p>())</span>
<a href=#__codelineno-1-16 id=__codelineno-1-16 name=__codelineno-1-16></a><span class=w>                </span><span class=p>.</span><span class=na>setAddress</span><span class=p>(</span><span class=n>addressToAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getAddress</span><span class=p>()))</span>
<a href=#__codelineno-1-17 id=__codelineno-1-17 name=__codelineno-1-17></a><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
<a href=#__codelineno-1-18 id=__codelineno-1-18 name=__codelineno-1-18></a><span class=w>    </span><span class=p>}</span>
<a href=#__codelineno-1-19 id=__codelineno-1-19 name=__codelineno-1-19></a>
<a href=#__codelineno-1-20 id=__codelineno-1-20 name=__codelineno-1-20></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>AddressAvro</span><span class=w> </span><span class=nf>addressToAvro</span><span class=p>(</span><span class=n>Address</span><span class=w> </span><span class=n>address</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-1-21 id=__codelineno-1-21 name=__codelineno-1-21></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>AddressAvro</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span>
<a href=#__codelineno-1-22 id=__codelineno-1-22 name=__codelineno-1-22></a><span class=w>                </span><span class=p>.</span><span class=na>setStreet</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getStreet</span><span class=p>())</span>
<a href=#__codelineno-1-23 id=__codelineno-1-23 name=__codelineno-1-23></a><span class=w>                </span><span class=p>.</span><span class=na>setCity</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getCity</span><span class=p>())</span>
<a href=#__codelineno-1-24 id=__codelineno-1-24 name=__codelineno-1-24></a><span class=w>                </span><span class=p>.</span><span class=na>setPostalCode</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getPostalCode</span><span class=p>())</span>
<a href=#__codelineno-1-25 id=__codelineno-1-25 name=__codelineno-1-25></a><span class=w>                </span><span class=p>.</span><span class=na>setCountry</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getCountry</span><span class=p>())</span>
<a href=#__codelineno-1-26 id=__codelineno-1-26 name=__codelineno-1-26></a><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
<a href=#__codelineno-1-27 id=__codelineno-1-27 name=__codelineno-1-27></a><span class=w>    </span><span class=p>}</span>
</code></pre></div><p>In addition, the Avro schema requires all the fields to be non-null except <code>middleName</code> and <code>postalCode</code>. If a required field is <code>null</code>, the Avro builder will throw an <code>AvroRuntimeException</code>.<h2 id=test-cases>Test cases<a title="Permanent link" class=headerlink href=#test-cases>¶</a></h2><p>Good tests should cover all branches of conditional logic. This gives us greater confidence in our code and oftentimes uncovers issues we may have overlooked. Although our service is very simple, it still presents a few scenarios that need to be covered.<table><thead><tr><th>Test case<th>Expectation<tbody><tr><td>Successful conversion<td>An <code>ApplicantAvro</code> object<tr><td>Applicant is under 18<td>Validation error: <code>IllegalArgumentException</code><tr><td>Applicant is over 25<td>Validation error: <code>IllegalArgumentException</code><tr><td>Applicant has grade C, D, or E<td>Validation error: <code>IllegalArgumentException</code><tr><td>Applicant missing required data<td>Conversion error: <code>AvroRuntimeException</code><tr><td>Applicant missing optional data<td>An <code>ApplicantAvro</code> object</table><h3 id=successful-scenario>Successful scenario<a title="Permanent link" class=headerlink href=#successful-scenario>¶</a></h3><p>Testing the successful scenario <em>"should be"</em> straightforward:<ul><li>construct a <strong>valid</strong> object (age 18-25, grade A or B, and all required fields are not null)<li>pass it to the method under test<li>verify result has expected values</ul><p>However, if we want to be thorough, then we need to verify as many valid states as <em>reasonably</em> possible. For example, is the range inclusive or exclusive? Our range is inclusive, so we should have a test for an applicant aged 18, and another 25. We don't really need to verify the numbers in the middle. This will ensure our service implemented the numeric bounds check correctly. We should also test an applicant with grade A, and another with grade B. Finally, we should verify that our service is not rejecting an applicant if optional data (such as <code>middleName</code>) is missing.<h3 id=application-validation>Application validation<a title="Permanent link" class=headerlink href=#application-validation>¶</a></h3><p>Testing <strong>validation</strong> errors also <em>"should not"</em> be too difficult:<ul><li>construct an <strong>invalid</strong> object<li>pass it to the method under test<li>verify the method throws the expected exception</ul><p>Here again we should cover as many bases as <em>reasonably</em> possible. This includes applicants aged 17 and 26 and those with grades C, D, and F.<h3 id=schema-validation>Schema validation<a title="Permanent link" class=headerlink href=#schema-validation>¶</a></h3><p>Finally, we have schema validation implemented within auto-generated Avro classes. For example, <code>firstName</code> is required in our <a href=https://github.com/instancio/instancio-samples/blob/main/instancio-models-sample/src/main/avro/applicant.avsc>schema</a>, therefore passing <code>null</code> to <code>setFirstName()</code> will throw an <code>AvroRuntimeException</code>. We should have a test for that. Ideally, we should verify this with <strong>every</strong> required field being <code>null</code>. Doing so has two benefits:<ol><li>it guarantees that we will not introduce unintended changes when modifying the schema in the future;<li>if we switch from Avro to another format, the test will ensure the same constraints are enforced in the new schema.</ol><p>However, most real world projects will rarely go this far due to time constraints or simply because it is too much effort. We will look at how to implement such a test fairly easily using Instancio.<h2 id=writing-tests>Writing tests<a title="Permanent link" class=headerlink href=#writing-tests>¶</a></h2><h3 id=implementing-successful-scenario-tests>Implementing successful scenario tests<a title="Permanent link" class=headerlink href=#implementing-successful-scenario-tests>¶</a></h3><p>Let's start by testing a valid applicant. Typically, it will be implemented as follows:<div class=highlight><pre><span></span><code><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=nd>@Test</span>
<a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>"Valid applicant should be successfully converted to Avro"</span><span class=p>)</span>
<a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a><span class=kt>void</span><span class=w> </span><span class=nf>verifyValidApplicantAvro</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>    </span><span class=c1>// Given</span>
<a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createValidApplicant</span><span class=p>();</span>
<a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>
<a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>    </span><span class=c1>// When</span>
<a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>    </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=n>applicantAvro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>);</span>
<a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a>
<a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a><span class=w>    </span><span class=c1>// Then</span>
<a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>).</span><span class=na>isNotNull</span><span class=p>();</span>
<a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getFirstName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getFirstName</span><span class=p>());</span>
<a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>());</span>
<a href=#__codelineno-2-14 id=__codelineno-2-14 name=__codelineno-2-14></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getLastName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getLastName</span><span class=p>());</span>
<a href=#__codelineno-2-15 id=__codelineno-2-15 name=__codelineno-2-15></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getAge</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getAge</span><span class=p>());</span>
<a href=#__codelineno-2-16 id=__codelineno-2-16 name=__codelineno-2-16></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getGrade</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getGrade</span><span class=p>().</span><span class=na>name</span><span class=p>());</span>
<a href=#__codelineno-2-17 id=__codelineno-2-17 name=__codelineno-2-17></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getAddress</span><span class=p>()).</span><span class=na>isNotNull</span><span class=p>();</span>
<a href=#__codelineno-2-18 id=__codelineno-2-18 name=__codelineno-2-18></a>
<a href=#__codelineno-2-19 id=__codelineno-2-19 name=__codelineno-2-19></a><span class=w>    </span><span class=n>Address</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>applicant</span><span class=p>.</span><span class=na>getAddress</span><span class=p>();</span>
<a href=#__codelineno-2-20 id=__codelineno-2-20 name=__codelineno-2-20></a><span class=w>    </span><span class=n>AddressAvro</span><span class=w> </span><span class=n>addressAvro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getAddress</span><span class=p>();</span>
<a href=#__codelineno-2-21 id=__codelineno-2-21 name=__codelineno-2-21></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>addressAvro</span><span class=p>.</span><span class=na>getStreet</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getStreet</span><span class=p>());</span>
<a href=#__codelineno-2-22 id=__codelineno-2-22 name=__codelineno-2-22></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>addressAvro</span><span class=p>.</span><span class=na>getCity</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getCity</span><span class=p>());</span>
<a href=#__codelineno-2-23 id=__codelineno-2-23 name=__codelineno-2-23></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>addressAvro</span><span class=p>.</span><span class=na>getCountry</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getCountry</span><span class=p>());</span>
<a href=#__codelineno-2-24 id=__codelineno-2-24 name=__codelineno-2-24></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>addressAvro</span><span class=p>.</span><span class=na>getPostalCode</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getPostalCode</span><span class=p>());</span>
<a href=#__codelineno-2-25 id=__codelineno-2-25 name=__codelineno-2-25></a><span class=p>}</span>
<a href=#__codelineno-2-26 id=__codelineno-2-26 name=__codelineno-2-26></a>
<a href=#__codelineno-2-27 id=__codelineno-2-27 name=__codelineno-2-27></a><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Applicant</span><span class=w> </span><span class=nf>createValidApplicant</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-2-28 id=__codelineno-2-28 name=__codelineno-2-28></a><span class=w>    </span><span class=n>Address</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Address</span><span class=p>();</span>
<a href=#__codelineno-2-29 id=__codelineno-2-29 name=__codelineno-2-29></a><span class=w>    </span><span class=n>address</span><span class=p>.</span><span class=na>setStreet</span><span class=p>(</span><span class=s>"street"</span><span class=p>);</span>
<a href=#__codelineno-2-30 id=__codelineno-2-30 name=__codelineno-2-30></a><span class=w>    </span><span class=n>address</span><span class=p>.</span><span class=na>setCity</span><span class=p>(</span><span class=s>"city"</span><span class=p>);</span>
<a href=#__codelineno-2-31 id=__codelineno-2-31 name=__codelineno-2-31></a><span class=w>    </span><span class=n>address</span><span class=p>.</span><span class=na>setCountry</span><span class=p>(</span><span class=s>"country"</span><span class=p>);</span>
<a href=#__codelineno-2-32 id=__codelineno-2-32 name=__codelineno-2-32></a><span class=w>    </span><span class=n>address</span><span class=p>.</span><span class=na>setPostalCode</span><span class=p>(</span><span class=s>"postal-code"</span><span class=p>);</span>
<a href=#__codelineno-2-33 id=__codelineno-2-33 name=__codelineno-2-33></a>
<a href=#__codelineno-2-34 id=__codelineno-2-34 name=__codelineno-2-34></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Applicant</span><span class=p>();</span>
<a href=#__codelineno-2-35 id=__codelineno-2-35 name=__codelineno-2-35></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setFirstName</span><span class=p>(</span><span class=s>"first-name"</span><span class=p>);</span>
<a href=#__codelineno-2-36 id=__codelineno-2-36 name=__codelineno-2-36></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setLastName</span><span class=p>(</span><span class=s>"last-name"</span><span class=p>);</span>
<a href=#__codelineno-2-37 id=__codelineno-2-37 name=__codelineno-2-37></a><span class=hll><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setAge</span><span class=p>(</span><span class=mi>18</span><span class=p>);</span>
</span><a href=#__codelineno-2-38 id=__codelineno-2-38 name=__codelineno-2-38></a><span class=hll><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setGrade</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=p>);</span>
</span><a href=#__codelineno-2-39 id=__codelineno-2-39 name=__codelineno-2-39></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setAddress</span><span class=p>(</span><span class=n>address</span><span class=p>);</span>
<a href=#__codelineno-2-40 id=__codelineno-2-40 name=__codelineno-2-40></a>
<a href=#__codelineno-2-41 id=__codelineno-2-41 name=__codelineno-2-41></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>applicant</span><span class=p>;</span>
<a href=#__codelineno-2-42 id=__codelineno-2-42 name=__codelineno-2-42></a><span class=p>}</span>
</code></pre></div><p>We create a valid applicant and pass it to the method under test. However, note the highlighted lines. The above test does not verify other successful scenarios we outlined earlier. To do so, we can add parameters using JUnit 5 <code>@ParameterizedTest</code> to construct an applicant with different values. The updated code is shown below. JUnit will automatically convert parameters to correct types, including the enum.<div class=highlight><pre><span></span><code><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=nd>@CsvSource</span><span class=p>({</span>
<a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=w>        </span><span class=s>"18, A"</span><span class=p>,</span>
<a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>        </span><span class=s>"18, B"</span><span class=p>,</span>
<a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>        </span><span class=s>"25, A"</span><span class=p>,</span>
<a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w>        </span><span class=s>"25, B"</span>
<a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=p>})</span>
<a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a><span class=nd>@ParameterizedTest</span>
<a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a><span class=kt>void</span><span class=w> </span><span class=nf>verifyValidApplicantAvro</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=w> </span><span class=n>grade</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a><span class=hll><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createValidApplicant</span><span class=p>(</span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>grade</span><span class=p>);</span>
</span><a href=#__codelineno-3-10 id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>    </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=n>applicantAvro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>);</span>
<a href=#__codelineno-3-11 id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>    </span><span class=c1>// Remaining code is the same</span>
<a href=#__codelineno-3-12 id=__codelineno-3-12 name=__codelineno-3-12></a><span class=p>}</span>
<a href=#__codelineno-3-13 id=__codelineno-3-13 name=__codelineno-3-13></a>
<a href=#__codelineno-3-14 id=__codelineno-3-14 name=__codelineno-3-14></a><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Applicant</span><span class=w> </span><span class=nf>createValidApplicant</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=w> </span><span class=n>grade</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-3-15 id=__codelineno-3-15 name=__codelineno-3-15></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Applicant</span><span class=p>();</span>
<a href=#__codelineno-3-16 id=__codelineno-3-16 name=__codelineno-3-16></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setAge</span><span class=p>(</span><span class=n>age</span><span class=p>);</span>
<a href=#__codelineno-3-17 id=__codelineno-3-17 name=__codelineno-3-17></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setGrade</span><span class=p>(</span><span class=n>grade</span><span class=p>);</span>
<a href=#__codelineno-3-18 id=__codelineno-3-18 name=__codelineno-3-18></a><span class=w>    </span><span class=c1>// Remaining code is the same</span>
<a href=#__codelineno-3-19 id=__codelineno-3-19 name=__codelineno-3-19></a>
<a href=#__codelineno-3-20 id=__codelineno-3-20 name=__codelineno-3-20></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>applicant</span><span class=p>;</span>
<a href=#__codelineno-3-21 id=__codelineno-3-21 name=__codelineno-3-21></a><span class=p>}</span>
</code></pre></div><p>Finally, we need to verify that the service does not reject an applicant if optional fields <code>middleName</code> and <code>postalCode</code> are <code>null</code>. At this point, the test is already starting to get more complicated and forcing us to make decisions on how to proceed. Possible options are:<ol><li>update the parameterized test to include <code>middleName</code> and <code>postalCode</code><li>do not populate optional fields in <code>createValidApplicant()</code><li>refactor <code>ParameterizedTest</code> to use <code>@MethodSource</code> instead of <code>@CsvSource</code><li>create a new test method</ol><p><strong>Option 1</strong> seems messy. Adding parameters makes the code harder to read and maintain. What if we need to add more optional parameters in the future?<div class="admonition quote"><p class=admonition-title><em>Clean Code</em>, Robert C. Martin<p>The ideal number of arguments for a function is zero (niladic). Next comes one (monadic), followed closely by two (dyadic). Three arguments (triadic) should be avoided where possible. More than three (polyadic) requires very special justification - and then shouldn’t be used anyway.</div><p><strong>Option 2</strong> is also not ideal. If the optional values are <code>null</code> then we are no longer testing the mapping for those fields. Both, expected and actual, would always be <code>null</code> giving us a false sense of confidence.<div class=highlight><pre><span></span><code><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>());</span>
<a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=n>assertThat</span><span class=p>(</span><span class=n>addressAvro</span><span class=p>.</span><span class=na>getPostalCode</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>getPostalCode</span><span class=p>());</span>
</code></pre></div><p><strong>Option 3</strong> would be to modify the test method. Maybe instead of passing individual arguments to the parameterized test, we pass an <code>Applicant</code> object as an argument. This can be implemented using <code>@MethodSource</code> as the source of arguments.<div class=highlight><pre><span></span><code><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=hll><span class=nd>@MethodSource</span><span class=p>(</span><span class=s>"validApplicants"</span><span class=p>)</span>
</span><a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a><span class=nd>@ParameterizedTest</span>
<a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=hll><span class=kt>void</span><span class=w> </span><span class=nf>verifyValidApplicantAvro</span><span class=p>(</span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>    </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=n>applicantAvro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>);</span>
<a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>    </span><span class=c1>// Remaining code is the same</span>
<a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a><span class=p>}</span>
<a href=#__codelineno-5-7 id=__codelineno-5-7 name=__codelineno-5-7></a>
<a href=#__codelineno-5-8 id=__codelineno-5-8 name=__codelineno-5-8></a><span class=hll><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Stream</span><span class=o><</span><span class=n>Arguments</span><span class=o>></span><span class=w> </span><span class=nf>validApplicants</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><a href=#__codelineno-5-9 id=__codelineno-5-9 name=__codelineno-5-9></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createValidApplicant</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=p>);</span>
<a href=#__codelineno-5-10 id=__codelineno-5-10 name=__codelineno-5-10></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createValidApplicant</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>);</span>
<a href=#__codelineno-5-11 id=__codelineno-5-11 name=__codelineno-5-11></a>
<a href=#__codelineno-5-12 id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>    </span><span class=c1>// Set optional fields to null</span>
<a href=#__codelineno-5-13 id=__codelineno-5-13 name=__codelineno-5-13></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createValidApplicant</span><span class=p>(</span><span class=mi>25</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>);</span>
<a href=#__codelineno-5-14 id=__codelineno-5-14 name=__codelineno-5-14></a><span class=w>    </span><span class=n>applicant3</span><span class=p>.</span><span class=na>setMiddleName</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a href=#__codelineno-5-15 id=__codelineno-5-15 name=__codelineno-5-15></a><span class=w>    </span><span class=n>applicant3</span><span class=p>.</span><span class=na>getAddress</span><span class=p>().</span><span class=na>setPostalCode</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a href=#__codelineno-5-16 id=__codelineno-5-16 name=__codelineno-5-16></a>
<a href=#__codelineno-5-17 id=__codelineno-5-17 name=__codelineno-5-17></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span>
<a href=#__codelineno-5-18 id=__codelineno-5-18 name=__codelineno-5-18></a><span class=w>            </span><span class=n>Arguments</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>applicant1</span><span class=p>),</span>
<a href=#__codelineno-5-19 id=__codelineno-5-19 name=__codelineno-5-19></a><span class=w>            </span><span class=n>Arguments</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>applicant2</span><span class=p>),</span>
<a href=#__codelineno-5-20 id=__codelineno-5-20 name=__codelineno-5-20></a><span class=w>            </span><span class=n>Arguments</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>applicant3</span><span class=p>)</span>
<a href=#__codelineno-5-21 id=__codelineno-5-21 name=__codelineno-5-21></a><span class=w>            </span><span class=c1>// etc...</span>
<a href=#__codelineno-5-22 id=__codelineno-5-22 name=__codelineno-5-22></a><span class=w>    </span><span class=p>);</span>
<a href=#__codelineno-5-23 id=__codelineno-5-23 name=__codelineno-5-23></a><span class=p>}</span>
</code></pre></div><p><strong>Option 4</strong> is to simply create a new test method as shown below. Since we are adding a new test method, we will need refactor the assertions into a separate <code>assertApplicant()</code> method to avoid duplicating them.<div class=highlight><pre><span></span><code><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a><span class=nd>@Test</span>
<a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>"Applicant with missing optional data should not be rejected"</span><span class=p>)</span>
<a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a><span class=kt>void</span><span class=w> </span><span class=nf>applicantWithMissingOptionalData</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a><span class=w>    </span><span class=c1>// Given</span>
<a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createValidApplicant</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=p>);</span>
<a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>setMiddleName</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a><span class=w>    </span><span class=n>applicant</span><span class=p>.</span><span class=na>getAddress</span><span class=p>().</span><span class=na>setPostalCode</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a href=#__codelineno-6-8 id=__codelineno-6-8 name=__codelineno-6-8></a>
<a href=#__codelineno-6-9 id=__codelineno-6-9 name=__codelineno-6-9></a><span class=w>    </span><span class=c1>// When</span>
<a href=#__codelineno-6-10 id=__codelineno-6-10 name=__codelineno-6-10></a><span class=w>    </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=n>applicantAvro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>);</span>
<a href=#__codelineno-6-11 id=__codelineno-6-11 name=__codelineno-6-11></a>
<a href=#__codelineno-6-12 id=__codelineno-6-12 name=__codelineno-6-12></a><span class=w>    </span><span class=c1>// Then</span>
<a href=#__codelineno-6-13 id=__codelineno-6-13 name=__codelineno-6-13></a><span class=w>    </span><span class=n>assertApplicant</span><span class=p>(</span><span class=n>applicant</span><span class=p>,</span><span class=w> </span><span class=n>applicantAvro</span><span class=p>);</span>
<a href=#__codelineno-6-14 id=__codelineno-6-14 name=__codelineno-6-14></a><span class=p>}</span>
<a href=#__codelineno-6-15 id=__codelineno-6-15 name=__codelineno-6-15></a>
<a href=#__codelineno-6-16 id=__codelineno-6-16 name=__codelineno-6-16></a><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>assertApplicant</span><span class=p>(</span><span class=kd>final</span><span class=w> </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=p>,</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=n>applicantAvro</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-6-17 id=__codelineno-6-17 name=__codelineno-6-17></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getFirstName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getFirstName</span><span class=p>());</span>
<a href=#__codelineno-6-18 id=__codelineno-6-18 name=__codelineno-6-18></a><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>applicantAvro</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getMiddleName</span><span class=p>());</span>
<a href=#__codelineno-6-19 id=__codelineno-6-19 name=__codelineno-6-19></a><span class=w>    </span><span class=c1>// Remaining assertions...</span>
<a href=#__codelineno-6-20 id=__codelineno-6-20 name=__codelineno-6-20></a><span class=p>}</span>
</code></pre></div><h4 id=improving-the-test>Improving the test<a title="Permanent link" class=headerlink href=#improving-the-test>¶</a></h4><p>As we saw, test code can start to get more complicated and time-consuming very quickly even with our simple service. Let's see how we can improve it. We are going to replace the data setup method by delegating object creation to Instancio. An <code>Applicant</code> can be created simply as follows:<div class=highlight><pre><span></span><code><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>Applicant</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
</code></pre></div><p>However, since we need a valid applicant with a certain age range and grades, we need to specify those parameters as well. Below is our test and the updated <code>createValidApplicant()</code> method:<div class=highlight><pre><span></span><code><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a><span class=nd>@Test</span>
<a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>"Valid applicant should be successfully converted to Avro"</span><span class=p>)</span>
<a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a><span class=kt>void</span><span class=w> </span><span class=nf>verifyValidApplicantAvro</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a><span class=hll><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>createValidApplicant</span><span class=p>());</span>
</span><a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a><span class=w>    </span><span class=c1>// Remaining code is the same</span>
<a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a><span class=p>}</span>
<a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a>
<a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Applicant</span><span class=w> </span><span class=nf>createValidApplicant</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>Applicant</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
<a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a><span class=hll><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>field</span><span class=p>(</span><span class=s>"age"</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>ints</span><span class=p>().</span><span class=na>range</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=mi>25</span><span class=p>))</span>
</span><a href=#__codelineno-8-11 id=__codelineno-8-11 name=__codelineno-8-11></a><span class=hll><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>all</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>class</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>oneOf</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>))</span>
</span><a href=#__codelineno-8-12 id=__codelineno-8-12 name=__codelineno-8-12></a><span class=w>            </span><span class=p>.</span><span class=na>create</span><span class=p>();</span>
<a href=#__codelineno-8-13 id=__codelineno-8-13 name=__codelineno-8-13></a><span class=p>}</span>
</code></pre></div><p>Notice that we no longer need to use <code>@ParameterizedTest</code> or worry about populating a valid <code>Applicant</code> object in different states. When the test runs, Instancio will generate an <code>Applicant</code> based on the specified parameters. Since the object is randomly generated, our test will automatically cover different permutations of valid applicants.<p>We also need to verify that when optional fields are <code>null</code>, the method under test still works as expected. By default, Instancio generates non-null values. Therefore, we need to specify which fields are nullable. This can be done by tweaking <code>Applicant</code> creation as follows:<div class=highlight><pre><span></span><code><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Applicant</span><span class=w> </span><span class=nf>createValidApplicant</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>Applicant</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
<a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a><span class=hll><span class=w>            </span><span class=p>.</span><span class=na>withNullable</span><span class=p>(</span><span class=n>all</span><span class=p>(</span>
</span><a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a><span class=hll><span class=w>                    </span><span class=n>field</span><span class=p>(</span><span class=s>"middleName"</span><span class=p>),</span>
</span><a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a><span class=hll><span class=w>                    </span><span class=n>field</span><span class=p>(</span><span class=n>Address</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=s>"postalCode"</span><span class=p>)))</span>
</span><a href=#__codelineno-9-6 id=__codelineno-9-6 name=__codelineno-9-6></a><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>field</span><span class=p>(</span><span class=s>"age"</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>ints</span><span class=p>().</span><span class=na>range</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=mi>25</span><span class=p>))</span>
<a href=#__codelineno-9-7 id=__codelineno-9-7 name=__codelineno-9-7></a><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>all</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>class</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>oneOf</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>))</span>
<a href=#__codelineno-9-8 id=__codelineno-9-8 name=__codelineno-9-8></a><span class=w>            </span><span class=p>.</span><span class=na>create</span><span class=p>();</span>
</code></pre></div><p>The <code>withNullable()</code> method will randomly generate <code>null</code> values for the specified fields. The <code>all()</code> selector is a convenience method for grouping multiple selectors together.<p>Finally, JUnit 5 offers the <code>@RepeatedTest</code> annotation which can be used for executing a test multiple times. We could use this annotation to ensure a greater number of data permutations our test is run against. It might be unnecessary given the limited range of inputs in this simple example, however, it is a good option to have at disposal when working with larger data sets.<div class=highlight><pre><span></span><code><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a><span class=hll><span class=nd>@RepeatedTest</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span><a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a><span class=kt>void</span><span class=w> </span><span class=nf>verifyValidApplicantAvro</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span>
</code></pre></div><p>This completes our "success scenario" test case. Next we will test the validation rules.<h3 id=implementing-application-validation-tests>Implementing application validation tests<a title="Permanent link" class=headerlink href=#implementing-application-validation-tests>¶</a></h3><p>As a reminder, the service throws an exception if an <code>Applicant</code> does not meet the following requirements:<div class=highlight><pre><span></span><code><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a><span class=kd>public</span><span class=w> </span><span class=n>ApplicantAvro</span><span class=w> </span><span class=nf>toAvro</span><span class=p>(</span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a>
<a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=w>    </span><span class=n>Validate</span><span class=p>.</span><span class=na>isTrue</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getAge</span><span class=p>()</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=mi>18</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>applicant</span><span class=p>.</span><span class=na>getAge</span><span class=p>()</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=mi>25</span><span class=p>,</span>
<a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a><span class=w>            </span><span class=s>"Applicant must be between 18 and 25 years of age"</span><span class=p>);</span>
<a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a>
<a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a><span class=w>    </span><span class=n>Validate</span><span class=p>.</span><span class=na>isTrue</span><span class=p>(</span><span class=n>applicant</span><span class=p>.</span><span class=na>getGrade</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>applicant</span><span class=p>.</span><span class=na>getGrade</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>,</span>
<a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a><span class=w>            </span><span class=s>"Applicant's grade must be either A or B"</span><span class=p>);</span>
<a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a>
<a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a><span class=w>    </span><span class=c1>// ...snip...</span>
<a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a><span class=p>}</span>
</code></pre></div><p>Just as before, this requires constructing <code>Applicant</code> objects in different states. This time we will solve the problem using an Instancio <code>Model</code>. A model can be thought of as a template for generating objects. To create a model, the <code>createValidApplicant()</code> method can be modified as follows:<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span>
<span class=normal><a href=#__codelineno-12-2>2</a></span>
<span class=normal><a href=#__codelineno-12-3>3</a></span>
<span class=normal><a href=#__codelineno-12-4>4</a></span>
<span class=normal><a href=#__codelineno-12-5>5</a></span>
<span class=normal><a href=#__codelineno-12-6>6</a></span>
<span class=normal><a href=#__codelineno-12-7>7</a></span>
<span class=normal><a href=#__codelineno-12-8>8</a></span>
<span class=normal><a href=#__codelineno-12-9>9</a></span></pre></div><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=hll><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Model</span><span class=o><</span><span class=n>Applicant</span><span class=o>></span><span class=w> </span><span class=nf>createValidApplicantModel</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><a id=__codelineno-12-2 name=__codelineno-12-2></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>Applicant</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
<a id=__codelineno-12-3 name=__codelineno-12-3></a><span class=w>            </span><span class=p>.</span><span class=na>withNullable</span><span class=p>(</span><span class=n>all</span><span class=p>(</span>
<a id=__codelineno-12-4 name=__codelineno-12-4></a><span class=w>                    </span><span class=n>field</span><span class=p>(</span><span class=s>"middleName"</span><span class=p>),</span>
<a id=__codelineno-12-5 name=__codelineno-12-5></a><span class=w>                    </span><span class=n>field</span><span class=p>(</span><span class=n>Address</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=s>"postalCode"</span><span class=p>)))</span>
<a id=__codelineno-12-6 name=__codelineno-12-6></a><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>field</span><span class=p>(</span><span class=s>"age"</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>ints</span><span class=p>().</span><span class=na>range</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=mi>25</span><span class=p>))</span>
<a id=__codelineno-12-7 name=__codelineno-12-7></a><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>all</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>class</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>oneOf</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>A</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>B</span><span class=p>))</span>
<a id=__codelineno-12-8 name=__codelineno-12-8></a><span class=hll><span class=w>            </span><span class=p>.</span><span class=na>toModel</span><span class=p>();</span>
</span><a id=__codelineno-12-9 name=__codelineno-12-9></a><span class=p>}</span>
</code></pre></div></table></div><p>The highlighted lines are the modifications. First, the method signature now returns <code>Model&LTApplicant></code> (and the method was renamed to <code>createValidApplicantModel()</code>). The second change is instead of calling <code>create()</code>, which returns an <code>Applicant</code> instance, now we call <code>toModel()</code>. We can now use this model instance as a template to generate <code>Applicant</code> instances as follows:<div class=highlight><pre><span></span><code><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>createValidApplicantModel</span><span class=p>());</span>
</code></pre></div><p>Using the valid applicant model, we can also construct <strong>invalid</strong> applicants by overriding certain parameters. For example, age validation can be verified by using the valid applicant model and applying invalid age parameters as shown below.<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1> 1</a></span>
<span class=normal><a href=#__codelineno-14-2> 2</a></span>
<span class=normal><a href=#__codelineno-14-3> 3</a></span>
<span class=normal><a href=#__codelineno-14-4> 4</a></span>
<span class=normal><a href=#__codelineno-14-5> 5</a></span>
<span class=normal><a href=#__codelineno-14-6> 6</a></span>
<span class=normal><a href=#__codelineno-14-7> 7</a></span>
<span class=normal><a href=#__codelineno-14-8> 8</a></span>
<span class=normal><a href=#__codelineno-14-9> 9</a></span>
<span class=normal><a href=#__codelineno-14-10>10</a></span>
<span class=normal><a href=#__codelineno-14-11>11</a></span></pre></div><td class=code><div><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1></a><span class=nd>@Test</span>
<a id=__codelineno-14-2 name=__codelineno-14-2></a><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>"Validation should fail if applicant is under 18 or over 25"</span><span class=p>)</span>
<a id=__codelineno-14-3 name=__codelineno-14-3></a><span class=kt>void</span><span class=w> </span><span class=nf>applicantAgeValidation</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-14-4 name=__codelineno-14-4></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>createValidApplicantModel</span><span class=p>())</span>
<a id=__codelineno-14-5 name=__codelineno-14-5></a><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>field</span><span class=p>(</span><span class=s>"age"</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>oneOf</span><span class=p>(</span><span class=mi>17</span><span class=p>,</span><span class=w> </span><span class=mi>26</span><span class=p>))</span>
<a id=__codelineno-14-6 name=__codelineno-14-6></a><span class=w>            </span><span class=p>.</span><span class=na>create</span><span class=p>();</span>
<a id=__codelineno-14-7 name=__codelineno-14-7></a>
<a id=__codelineno-14-8 name=__codelineno-14-8></a><span class=w>    </span><span class=n>assertThatThrownBy</span><span class=p>(()</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>))</span>
<a id=__codelineno-14-9 name=__codelineno-14-9></a><span class=w>            </span><span class=p>.</span><span class=na>isInstanceOf</span><span class=p>(</span><span class=n>IllegalArgumentException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
<a id=__codelineno-14-10 name=__codelineno-14-10></a><span class=w>            </span><span class=p>.</span><span class=na>hasMessage</span><span class=p>(</span><span class=s>"Applicant must be between 18 and 25 years of age"</span><span class=p>);</span>
<a id=__codelineno-14-11 name=__codelineno-14-11></a><span class=p>}</span>
</code></pre></div></table></div><p>The single test above covers applicants below and above the required age range. Grade validation can be tested in a similar manner by verifying grades C, D, and F.<div class=highlight><pre><span></span><code><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a><span class=nd>@Test</span>
<a href=#__codelineno-15-2 id=__codelineno-15-2 name=__codelineno-15-2></a><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>"Validation should fail if applicant's grade is lower than B"</span><span class=p>)</span>
<a href=#__codelineno-15-3 id=__codelineno-15-3 name=__codelineno-15-3></a><span class=kt>void</span><span class=w> </span><span class=nf>applicantGradeValidation</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a href=#__codelineno-15-4 id=__codelineno-15-4 name=__codelineno-15-4></a><span class=w>    </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>createValidApplicantModel</span><span class=p>())</span>
<a href=#__codelineno-15-5 id=__codelineno-15-5 name=__codelineno-15-5></a><span class=w>            </span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>all</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>class</span><span class=p>),</span><span class=w> </span><span class=n>gen</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>gen</span><span class=p>.</span><span class=na>oneOf</span><span class=p>(</span><span class=n>Grade</span><span class=p>.</span><span class=na>C</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>D</span><span class=p>,</span><span class=w> </span><span class=n>Grade</span><span class=p>.</span><span class=na>F</span><span class=p>))</span>
<a href=#__codelineno-15-6 id=__codelineno-15-6 name=__codelineno-15-6></a><span class=w>            </span><span class=p>.</span><span class=na>create</span><span class=p>();</span>
<a href=#__codelineno-15-7 id=__codelineno-15-7 name=__codelineno-15-7></a>
<a href=#__codelineno-15-8 id=__codelineno-15-8 name=__codelineno-15-8></a><span class=w>    </span><span class=n>assertThatThrownBy</span><span class=p>(()</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>))</span>
<a href=#__codelineno-15-9 id=__codelineno-15-9 name=__codelineno-15-9></a><span class=w>            </span><span class=p>.</span><span class=na>isInstanceOf</span><span class=p>(</span><span class=n>IllegalArgumentException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
<a href=#__codelineno-15-10 id=__codelineno-15-10 name=__codelineno-15-10></a><span class=w>            </span><span class=p>.</span><span class=na>hasMessage</span><span class=p>(</span><span class=s>"Applicant's grade must be either A or B"</span><span class=p>);</span>
<a href=#__codelineno-15-11 id=__codelineno-15-11 name=__codelineno-15-11></a><span class=p>}</span>
</code></pre></div><h3 id=implementing-schema-validation-tests>Implementing schema validation tests<a title="Permanent link" class=headerlink href=#implementing-schema-validation-tests>¶</a></h3><p>The last test left to implement is to verify the schema. We want to ensure that if any required field is set to <code>null</code>, the service throws the <code>AvroRuntimeException</code>. Essentially, we only want to test one required <code>null</code> field at a time. In order to achieve this goal, we will again use our applicant <code>Model</code> as the starting point and then nullify a required field. We will repeat this process for each required field, as shown in the following method.<div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-16-1> 1</a></span>
<span class=normal><a href=#__codelineno-16-2> 2</a></span>
<span class=normal><a href=#__codelineno-16-3> 3</a></span>
<span class=normal><a href=#__codelineno-16-4> 4</a></span>
<span class=normal><a href=#__codelineno-16-5> 5</a></span>
<span class=normal><a href=#__codelineno-16-6> 6</a></span>
<span class=normal><a href=#__codelineno-16-7> 7</a></span>
<span class=normal><a href=#__codelineno-16-8> 8</a></span>
<span class=normal><a href=#__codelineno-16-9> 9</a></span>
<span class=normal><a href=#__codelineno-16-10>10</a></span>
<span class=normal><a href=#__codelineno-16-11>11</a></span>
<span class=normal><a href=#__codelineno-16-12>12</a></span>
<span class=normal><a href=#__codelineno-16-13>13</a></span>
<span class=normal><a href=#__codelineno-16-14>14</a></span>
<span class=normal><a href=#__codelineno-16-15>15</a></span>
<span class=normal><a href=#__codelineno-16-16>16</a></span>
<span class=normal><a href=#__codelineno-16-17>17</a></span>
<span class=normal><a href=#__codelineno-16-18>18</a></span>
<span class=normal><a href=#__codelineno-16-19>19</a></span>
<span class=normal><a href=#__codelineno-16-20>20</a></span>
<span class=normal><a href=#__codelineno-16-21>21</a></span>
<span class=normal><a href=#__codelineno-16-22>22</a></span>
<span class=normal><a href=#__codelineno-16-23>23</a></span>
<span class=normal><a href=#__codelineno-16-24>24</a></span></pre></div><td class=code><div><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1></a><span class=nd>@Test</span>
<a id=__codelineno-16-2 name=__codelineno-16-2></a><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>"Should throw AvroRuntimeException if any of the required fields is null"</span><span class=p>)</span>
<a id=__codelineno-16-3 name=__codelineno-16-3></a><span class=kt>void</span><span class=w> </span><span class=nf>shouldThrowAvroRuntimeExceptionIfRequiredDataIsMissing</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-4 name=__codelineno-16-4></a><span class=w>    </span><span class=n>Selector</span><span class=o>[]</span><span class=w> </span><span class=n>requiredFields</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-5 name=__codelineno-16-5></a><span class=w>            </span><span class=n>field</span><span class=p>(</span><span class=n>Applicant</span><span class=p>::</span><span class=n>getFirstName</span><span class=p>),</span>
<a id=__codelineno-16-6 name=__codelineno-16-6></a><span class=w>            </span><span class=n>field</span><span class=p>(</span><span class=n>Applicant</span><span class=p>::</span><span class=n>getLastName</span><span class=p>),</span>
<a id=__codelineno-16-7 name=__codelineno-16-7></a><span class=w>            </span><span class=n>field</span><span class=p>(</span><span class=n>Address</span><span class=p>::</span><span class=n>getStreet</span><span class=p>),</span>
<a id=__codelineno-16-8 name=__codelineno-16-8></a><span class=w>            </span><span class=n>field</span><span class=p>(</span><span class=n>Address</span><span class=p>::</span><span class=n>getCity</span><span class=p>),</span>
<a id=__codelineno-16-9 name=__codelineno-16-9></a><span class=w>            </span><span class=n>field</span><span class=p>(</span><span class=n>Address</span><span class=p>::</span><span class=n>getCountry</span><span class=p>)</span>
<a id=__codelineno-16-10 name=__codelineno-16-10></a><span class=w>    </span><span class=p>};</span>
<a id=__codelineno-16-11 name=__codelineno-16-11></a>
<a id=__codelineno-16-12 name=__codelineno-16-12></a><span class=w>    </span><span class=c1>// Set each of these to null individually, so that only one required field is null at a time</span>
<a id=__codelineno-16-13 name=__codelineno-16-13></a><span class=w>    </span><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>requiredFields</span><span class=p>).</span><span class=na>forEach</span><span class=p>(</span><span class=n>selector</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-16-14 name=__codelineno-16-14></a><span class=w>        </span><span class=c1>// Given</span>
<a id=__codelineno-16-15 name=__codelineno-16-15></a><span class=w>        </span><span class=n>Applicant</span><span class=w> </span><span class=n>applicant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instancio</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>createValidApplicantModel</span><span class=p>())</span>
<a id=__codelineno-16-16 name=__codelineno-16-16></a><span class=w>                </span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>selector</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>)</span>
<a id=__codelineno-16-17 name=__codelineno-16-17></a><span class=hll><span class=w>                </span><span class=p>.</span><span class=na>create</span><span class=p>();</span>
</span><a id=__codelineno-16-18 name=__codelineno-16-18></a>
<a id=__codelineno-16-19 name=__codelineno-16-19></a><span class=w>        </span><span class=c1>// Then</span>
<a id=__codelineno-16-20 name=__codelineno-16-20></a><span class=w>        </span><span class=n>assertThatThrownBy</span><span class=p>(()</span><span class=w> </span><span class=o>-></span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>toAvro</span><span class=p>(</span><span class=n>applicant</span><span class=p>))</span>
<a id=__codelineno-16-21 name=__codelineno-16-21></a><span class=w>                </span><span class=p>.</span><span class=na>as</span><span class=p>(</span><span class=s>"Expected %s to be required"</span><span class=p>,</span><span class=w> </span><span class=n>selector</span><span class=p>)</span>
<a id=__codelineno-16-22 name=__codelineno-16-22></a><span class=w>                </span><span class=p>.</span><span class=na>isInstanceOf</span><span class=p>(</span><span class=n>AvroRuntimeException</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
<a id=__codelineno-16-23 name=__codelineno-16-23></a><span class=w>    </span><span class=p>});</span>
<a id=__codelineno-16-24 name=__codelineno-16-24></a><span class=p>}</span>
</code></pre></div></table></div><p>Being able to select fields programmatically offers allows us to implement this type of test fairly easily. Without library support, this type of testing would be tedious to implement. It would require manually calling setters with a <code>null</code> value or implementing similar logic using reflection. Neither of these options are practical.<h2 id=conclusion>Conclusion<a title="Permanent link" class=headerlink href=#conclusion>¶</a></h2><p>This concludes an overview of models. As we saw, writing tests can get tricky even when the class under test is fairly simple. Populating objects can be time-consuming. In addition, constructing objects in different states for different test cases presents its own challenges.<p>Using a data generator alleviates some of the above challenges. The random nature of the data allows us to test a wider range of conditions. This can reduce the number of test methods required to verify different outcomes. Test methods themselves become simpler. For example, in a lot of cases we can eliminate the need for <code>@ParameterizedTest</code>. In addition, the data setup code is more concise since we no longer need to manually populate objects. The data setup code itself is easier to maintain and more flexible to change.<h2 id=source-code>Source code<a title="Permanent link" class=headerlink href=#source-code>¶</a></h2><p>Source code from this article is available as a Maven project from the <a href=https://github.com/instancio/instancio-samples>instancio-samples</a> repository:<div class=highlight><pre><span></span><code><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/instancio/instancio-samples.git
<a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a><span class=nb>cd</span><span class=w> </span>instancio-samples/instancio-models-sample
<a href=#__codelineno-17-3 id=__codelineno-17-3 name=__codelineno-17-3></a>mvn<span class=w> </span>package
</code></pre></div></article></div><script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script></div></main><footer class=md-footer><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-footer-copyright><div class=md-footer-copyright__highlight>© Instancio 2022-2025</div> powered by <a href=https://www.mkdocs.org target=_blank title=MkDocs>MkDocs</a> and <a title="Material for MkDocs" href=https://squidfunk.github.io/mkdocs-material/ target=_blank> Material for MkDocs</a></div><div class=md-social></div></div></div></footer></div><div class=md-dialog data-md-component=dialog><div class="md-dialog__inner md-typeset"></div></div><script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "icons", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "toc.integrate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script><script src=../../assets/javascripts/bundle.83f73b43.min.js></script>